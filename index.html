<!doctype html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Laporan Keuangan Kelas VI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD version) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf-autotable.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { height: 6px; width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        .sticky-col { position: sticky; left: 0; background: white; z-index: 10; }
    </style>
</head>
<body class="bg-slate-50 min-h-full">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = window.React;

        // --- KONSTANTA DATA ---
        const STUDENT_NAMES = [
            "ABYAN ELFAHRI AZANI", "AINA CAHAYA KAMILA", "ANABELLA ZIANITA ALIYANOR AGUSTINE",
            "AVIKA AZZAHRA", "BAYU HUDA KURNIAWAN", "DAVIN PUTRA MAULANA",
            "FARICHI AZKA SATRIYO", "GHANI AUFAR HABIBI", "KEISHA ANINDYA SAKHI",
            "MUHAMMAD ILYAS YUNUS", "MUHAMMAD RIZQI ALMEIRA ABDUL ZUMAR", "NAUFAL AGHAM SYAHPUTRA",
            "NAYLA MUAZARARA ULFA ALFIAN", "NOVA ALYA NURFADILA", "RAFA RASENDRIYA CENDANI",
            "RAFA RAYHANAH TABINA", "RAFI FABIAN LOKHESWARA", "RAFIQ DESTUAJI PRAYOGA",
            "RAKA MAHATMA HIDAYAT", "RIZKA SETIYOWATI", "TIARA AKILA AMARILYS",
            "YUMNA SHAFINA RARA DEWI", "ZAIDAN ARIQ PRADITYA RAFIQ", "ARU ZULHA AL FATIH",
            "RAHMAT RAMADHON", "GENDHIS AYU KINANTHI", "DEVI NUR KURNIAWATI"
        ].sort();

        const CATEGORIES = ["LKS", "Sumbangan", "Tabungan", "TKA"];

        // --- KOMPONEN KECIL ---
        const Card = ({ title, amount, colorClass, isTotal = false }) => (
            <div className={`p-6 rounded-3xl bg-white shadow-sm border-b-4 ${colorClass} transition-all hover:shadow-md`}>
                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">{title}</p>
                <p className={`text-2xl font-black ${isTotal ? 'text-indigo-600' : 'text-slate-800'}`}>
                    {new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount)}
                </p>
            </div>
        );

        // --- APLIKASI UTAMA ---
        const App = () => {
            const [transactions, setTransactions] = useState(() => {
                const saved = localStorage.getItem('finance_6b_v3');
                return saved ? JSON.parse(saved) : [];
            });

            useEffect(() => {
                localStorage.setItem('finance_6b_v3', JSON.stringify(transactions));
            }, [transactions]);

            // Perhitungan Ringkasan Atas
            const summary = useMemo(() => {
                const totals = {};
                let grand = 0;
                transactions.forEach(t => {
                    totals[t.kategori] = (totals[t.kategori] || 0) + t.jumlah;
                    grand += t.jumlah;
                });
                return { totals, grand };
            }, [transactions]);

            // Perhitungan Rekap Per Siswa Per Kategori
            const rekapData = useMemo(() => {
                return STUDENT_NAMES.map(nama => {
                    const studentTx = transactions.filter(t => t.nama === nama);
                    const catTotals = {};
                    let studentGrandTotal = 0;
                    
                    CATEGORIES.forEach(cat => {
                        const sum = studentTx
                            .filter(t => t.kategori === cat)
                            .reduce((acc, curr) => acc + curr.jumlah, 0);
                        catTotals[cat] = sum;
                        studentGrandTotal += sum;
                    });
                    
                    return { nama, catTotals, studentGrandTotal };
                });
            }, [transactions]);

            const handleAdd = (e) => {
                e.preventDefault();
                const form = e.target;
                const newEntry = {
                    id: Date.now(),
                    nama: form.nama.value,
                    kategori: form.kategori.value,
                    jumlah: parseInt(form.jumlah.value),
                    tanggal: form.tanggal.value
                };
                setTransactions([newEntry, ...transactions]);
                form.reset();
                form.tanggal.value = new Date().toISOString().split('T')[0];
            };

            const deleteItem = (id) => {
                if (confirm("Hapus data ini?")) {
                    setTransactions(transactions.filter(t => t.id !== id));
                }
            };

            const formatMoney = (val) => val > 0 
                ? `Rp ${val.toLocaleString('id-ID')}` 
                : '-';

            const exportPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4'); // Landscape agar tabel rekap muat
                
                doc.setFontSize(18);
                doc.text("LAPORAN REKAPITULASI KEUANGAN KELAS VI", 14, 20);
                doc.setFontSize(10);
                doc.text(`Periode: Tahun Ajaran 2025/2026 | Dicetak: ${new Date().toLocaleString('id-ID')}`, 14, 28);

                // Tabel 1: Rekap Per Siswa
                doc.setFontSize(14);
                doc.text("1. Rekap Pembayaran Per Siswa", 14, 40);
                doc.autoTable({
                    startY: 45,
                    head: [['No', 'Nama Siswa', ...CATEGORIES, 'Total']],
                    body: rekapData.map((r, i) => [
                        i + 1, 
                        r.nama, 
                        ...CATEGORIES.map(c => r.catTotals[c].toLocaleString('id-ID')),
                        r.studentGrandTotal.toLocaleString('id-ID')
                    ]),
                    headStyles: { fillColor: [79, 70, 229] },
                    styles: { fontSize: 8 }
                });

                doc.addPage();
                doc.setFontSize(14);
                doc.text("2. Riwayat Transaksi Detail", 14, 20);
                doc.autoTable({
                    startY: 25,
                    head: [['No', 'Nama Siswa', 'Kategori', 'Jumlah', 'Tanggal']],
                    body: transactions.map((t, i) => [
                        i + 1, t.nama, t.kategori, t.jumlah.toLocaleString('id-ID'), t.tanggal
                    ]),
                    headStyles: { fillColor: [16, 185, 129] }
                });

                doc.save(`Rekap_Keuangan_6B_${Date.now()}.pdf`);
            };

            return (
                <div className="max-w-7xl mx-auto px-4 py-8 md:py-12 animate-in">
                    {/* Header */}
                    <header className="mb-12 text-center">
                        <div className="inline-block px-4 py-1 bg-indigo-100 text-indigo-600 rounded-full text-[10px] font-black mb-4 uppercase tracking-widest">
                            Bendahara Kelas
                        </div>
                        <h1 className="text-5xl font-black text-slate-900 tracking-tighter mb-2 italic">ADMIN 6B</h1>
                        <p className="text-slate-400 font-medium tracking-tight">SDN BENDAHARA - Sistem Rekap Keuangan Mandiri</p>
                    </header>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-10">
                        <Card title="Total Saldo Kas" amount={summary.grand} colorClass="border-indigo-600" isTotal />
                        {CATEGORIES.map(cat => (
                            <Card key={cat} title={cat} amount={summary.totals[cat] || 0} colorClass="border-slate-200" />
                        ))}
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* Kolom Kiri: Form Input */}
                        <div className="lg:col-span-4">
                            <div className="bg-white p-8 rounded-[40px] shadow-xl shadow-slate-200/50 border border-slate-100 sticky top-10">
                                <h2 className="text-xl font-black text-slate-800 mb-6 flex items-center gap-2">
                                    <span className="w-2 h-6 bg-indigo-600 rounded-full"></span>
                                    Input Transaksi
                                </h2>
                                <form onSubmit={handleAdd} className="space-y-5">
                                    <div>
                                        <label className="block text-[10px] font-black text-slate-400 uppercase mb-2">Nama Siswa</label>
                                        <input name="nama" list="std-list" className="w-full bg-slate-50 border-2 border-slate-50 p-4 rounded-2xl focus:bg-white focus:border-indigo-500 outline-none transition-all font-bold text-slate-700" placeholder="Cari nama..." required />
                                        <datalist id="std-list">
                                            {STUDENT_NAMES.map(s => <option key={s} value={s} />)}
                                        </datalist>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-[10px] font-black text-slate-400 uppercase mb-2">Kategori</label>
                                            <select name="kategori" className="w-full bg-slate-50 border-2 border-slate-50 p-4 rounded-2xl focus:bg-white focus:border-indigo-500 outline-none font-bold text-slate-700 appearance-none cursor-pointer" required>
                                                {CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-[10px] font-black text-slate-400 uppercase mb-2">Jumlah (Rp)</label>
                                            <input name="jumlah" type="number" className="w-full bg-slate-50 border-2 border-slate-50 p-4 rounded-2xl focus:bg-white focus:border-indigo-500 outline-none font-black text-xl text-slate-800" placeholder="0" required />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-[10px] font-black text-slate-400 uppercase mb-2">Tanggal</label>
                                        <input name="tanggal" type="date" defaultValue={new Date().toISOString().split('T')[0]} className="w-full bg-slate-50 border-2 border-slate-50 p-4 rounded-2xl focus:bg-white focus:border-indigo-500 outline-none font-bold text-slate-700" required />
                                    </div>
                                    <button type="submit" className="w-full bg-indigo-600 text-white font-black py-5 rounded-3xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 active:scale-95 transition-all uppercase tracking-widest text-xs">
                                        Simpan Sekarang
                                    </button>
                                </form>
                            </div>
                        </div>

                        {/* Kolom Kanan: Tabel Rekap dan Riwayat */}
                        <div className="lg:col-span-8 space-y-10">
                            
                            {/* TABEL REKAP PER SISWA */}
                            <section>
                                <div className="flex justify-between items-center mb-6 px-2">
                                    <h2 className="text-2xl font-black text-slate-800 tracking-tighter">Rekap Per Siswa</h2>
                                    <button onClick={exportPDF} className="bg-indigo-600 text-white px-6 py-2 rounded-full font-black text-[10px] hover:bg-indigo-700 transition-all shadow-md active:scale-95 uppercase tracking-widest">
                                        Unduh Rekap PDF
                                    </button>
                                </div>
                                <div className="bg-white rounded-[40px] shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="overflow-x-auto custom-scrollbar">
                                        <table className="w-full text-left">
                                            <thead className="bg-slate-50/80">
                                                <tr className="text-slate-400">
                                                    <th className="p-4 text-[10px] font-black uppercase tracking-widest text-center">No</th>
                                                    <th className="p-4 text-[10px] font-black uppercase tracking-widest sticky-col border-r border-slate-100 min-w-[200px]">Nama Siswa</th>
                                                    {CATEGORIES.map(cat => (
                                                        <th key={cat} className="p-4 text-[10px] font-black uppercase tracking-widest text-center">{cat}</th>
                                                    ))}
                                                    <th className="p-4 text-[10px] font-black uppercase tracking-widest text-right bg-indigo-50 text-indigo-600">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {rekapData.map((row, idx) => (
                                                    <tr key={row.nama} className="hover:bg-slate-50 transition-colors">
                                                        <td className="p-4 text-xs font-bold text-slate-300 text-center">{idx + 1}</td>
                                                        <td className="p-4 font-bold text-slate-700 sticky-col border-r border-slate-100 text-xs">{row.nama}</td>
                                                        {CATEGORIES.map(cat => (
                                                            <td key={cat} className="p-4 text-center text-xs font-medium text-slate-500">
                                                                {formatMoney(row.catTotals[cat])}
                                                            </td>
                                                        ))}
                                                        <td className="p-4 text-right font-black text-indigo-600 bg-indigo-50/30 text-xs">
                                                            Rp {row.studentGrandTotal.toLocaleString('id-ID')}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </section>

                            {/* RIWAYAT TRANSAKSI */}
                            <section>
                                <h2 className="text-2xl font-black text-slate-800 tracking-tighter mb-6 px-2">Riwayat Transaksi</h2>
                                <div className="bg-white rounded-[40px] shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="overflow-x-auto custom-scrollbar">
                                        <table className="w-full text-left">
                                            <thead className="bg-slate-50/50">
                                                <tr className="text-slate-400">
                                                    <th className="p-6 text-[10px] font-black uppercase tracking-widest">Siswa</th>
                                                    <th className="p-6 text-[10px] font-black uppercase tracking-widest">Kategori</th>
                                                    <th className="p-6 text-[10px] font-black uppercase tracking-widest text-right">Jumlah</th>
                                                    <th className="p-6 text-[10px] font-black uppercase tracking-widest text-center">Hapus</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {transactions.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="4" className="p-16 text-center">
                                                            <p className="text-slate-300 font-bold italic">Belum ada transaksi.</p>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    transactions.map(t => (
                                                        <tr key={t.id} className="hover:bg-indigo-50/30 transition-colors">
                                                            <td className="p-6">
                                                                <p className="font-bold text-slate-800 leading-none mb-1 text-sm">{t.nama}</p>
                                                                <p className="text-[10px] text-slate-400 font-medium tracking-tighter uppercase">{t.tanggal}</p>
                                                            </td>
                                                            <td className="p-6">
                                                                <span className="bg-slate-100 text-slate-500 px-3 py-1 rounded-full text-[10px] font-black uppercase">
                                                                    {t.kategori}
                                                                </span>
                                                            </td>
                                                            <td className="p-6 text-right">
                                                                <p className="font-black text-slate-900 text-sm">
                                                                    Rp {t.jumlah.toLocaleString('id-ID')}
                                                                </p>
                                                            </td>
                                                            <td className="p-6 text-center">
                                                                <button onClick={() => deleteItem(t.id)} className="text-slate-300 hover:text-red-500 transition-colors">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                    </svg>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
